<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>GnoFrame</title>
    <link href="styles.css" rel="stylesheet">
    <script src="gno-frame.js"></script>
<body>

<gno-frame>

    {
    "version": "0.1.0",
    "name": "GnoFrame",
    "iconUrl": "favicon-32x32.png",
    "homeUrl": "https://gno.land",
    "imageUrl": "android-chrome-512x512.png",
    "buttonTitle": "GnoFrame",
    "splashImageUrl": "",
    "splashBackgroundColor": "#ffffff",
    "webhookUrl": "https://gno.land/webhook"
    }

</gno-frame>

<script>
    class GnoFrame extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({mode: 'open'});
            this.shadowRoot.innerHTML = `
            <style>
            /* Add your styles here */
            :host {
                display: block;
                width: 100%;
                height: 100%;
            }
            </style>
            <div id="container">
            <slot></slot>
            </div>
        `;
        }

        connectedCallback() {
            const gnoFrame = document.querySelector('gno-frame');
            var data = ""
            try {
                data = JSON.parse(gnoFrame.innerHTML);
            } catch {
                console.error('Error parsing JSON:', error);
                return
            }
            this.shadowRoot.querySelector('#container').innerHTML = `
              <div>
              <h1>${data.name}</h1>
              <img src="${data.iconUrl}" alt="${data.name}">
              <p>${data.version}</p>
              <a href="${data.homeUrl}">Home</a>
              <img src="${data.imageUrl}" alt="${data.name}">
              <br />
              <br />
              <button>${data.buttonTitle}</button>
              </div>
          `;
            this.shadowRoot.querySelector('button').addEventListener('click', () => {
                const payload = {
                    name: data.name,
                    version: data.version,
                    iconUrl: data.iconUrl,
                    homeUrl: data.homeUrl,
                    imageUrl: data.imageUrl,
                    buttonTitle: data.buttonTitle,
                    splashImageUrl: data.splashImageUrl,
                    splashBackgroundColor: data.splashBackgroundColor,
                    webhookUrl: data.webhookUrl,
                };
                // REVIEW: could add post callback
                // fetch(webhookUrl, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify(payload)
                // })
                Promise.resolve({json: () => payload})
                    .then(response => response.json())
                    .then(data => console.log('Success:', data))
                    .catch((error) => console.error('Error:', error));
            });

        }
    }

    customElements.define('gno-frame', GnoFrame);
</script>
</body>
</html>
